<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="bootstrap-template/layout/basic">
<th:block layout:fragment="title">
    <title>like 게시글 목록</title>
</th:block>

<th:block layout:fragment="main-content">
    <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center" id="post-container">
    </div>
</th:block>



<th:block layout:fragment="script">
    <script th:inline="javascript">
        /*<![CDATA[*/

        /* 게시글 리스트 조회 S */
        window.onload = () => {
            console.log("게시글 리스트 조회====================");
            findAllPost();
        }

        function findAllPost() {
            var list = [[${likePosts}]];
            if (!list.length) {
                document.getElementById('post-container').innerHTML = '<div>좋아한 게시물이 없습니다.</div>';
                return false;
            }
            drawList(list);
        }

        // 조회 목록
        function drawList(list) {
            /* todo 좋아한 게시글 목록이기 때문에 추가처리 필요없음(추후 공통 사용할 수 있으므로 남겨둠)
            var likes = [[${likeNumbers}]];
            console.log('라이크====');
            console.log(likes);
            */

            var posting = '';
            list.forEach(obj => {
                console.log('오브젝트============');
                console.log(obj);

                posting += `<div class="col mb-5 list">
                    <div class="card h-100">
                    <img class="card-img-top" src="${obj.bbscttImage}" alt="..."
                    onError="javascript:this.src='https://dummyimage.com/450x450/dee2e6/6c757d.jpg'"/>`;

                // 좋아요 버튼
                posting += `<span class="d-flex text-danger mb-2 like-btn" id="like_${obj.bbscttNo}" style="position: absolute; top: 0.5rem; right: 0.5rem">`;

                posting += `<i class="bi bi-heart-fill"></i>`;
                /* todo 좋아한 게시글 목록이기 때문에 추가처리 필요없음(추후 공통 사용할 수 있으므로 남겨둠)
                if (likes.includes(obj.bbscttNo)) {
                    posting += `<i class="bi bi-heart-fill"></i>`;
                } else {
                    posting += `<i class="bi bi-heart"></i>`;
                }
                */

                posting += `</span>
                    <div class="card-body">
                    <div class="text-center">

                    <h6 class="fw-bolder">
                    ${obj.bbscttSj}
                    </h6>

                `;

                // 별점
                posting += '<div class="d-flex justify-content-center small text-warning mb-2">';
                for (var i = 0; i < obj.bbscttGrade; i++) {
                    posting += '<div class="bi-star-fill"></div>';
                }

                for (var j = 0; j < 5 - obj.bbscttGrade; j++) {
                    posting += '<div class="bi-star"></div>';
                }
                posting += '</div>';


                // 해시태그(3개까지만 보이게 처리) - 해시태그 비어있을경우 처리 추가
                if (obj.bbscttHashtag != null && obj.bbscttHashtag != '') {
                    var tag = obj.bbscttHashtag.split(',');
                    console.log('해시태그');
                    console.log(tag);

                    posting += '<div class="text-xs">';
                    var showSize = tag.length > 3? 3 : tag.length;
                    for (var k = 0; k < showSize; k++) {
                        posting += ' <a href="#" class="text-primary hash-tag">#' + tag[k] + '</a>';
                    }
                    posting += '</div>';
                }

                posting +=
                    '</div>' +
                    '</div>' +
                    '</div>' +
                    '</div>';
            });

            document.getElementById('post-container').innerHTML = posting;

            // 좋아요 클릭 이벤트 todo 아직 추가 안함
            /*
            var likeBtns = document.querySelectorAll('.like-btn');
            likeBtns.forEach( (btn) => {
                btn.onclick = likePost;
            });
            */

            // 해시태그 클릭 이벤트
            var tags = document.querySelectorAll('.hash-tag');
            tags.forEach( (tag) => {
                tag.onclick = clickTag;
            });
        }
        /* 게시글 리스트 조회 E */


        /* 해시태그 검색 S */
        function clickTag() {
            console.log('해시태그 클릭===========');

            var hashTag = String($(this).html().substring(1).trim());
            console.log('hashTag:' + hashTag);

            var queryParams = {
                /*
                page: (page) ? page : 1,
                recordSize : 10,
                pageSize : 10,
                */
                keyword : hashTag,
                searchType : 'bbscttHashtag'
            }
            location.href = location.pathname + '?' + new URLSearchParams(queryParams).toString();
        }
        /* 해시태그 검색 E */

    </script>

</th:block>
</html>